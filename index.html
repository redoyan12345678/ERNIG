<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earning App - User Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Firebase SDKs যুক্ত করা হয়েছে -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <style>
        /* CSS কোড (মোবাইল স্ট্যাটাস বার রিমুভ করা হয়েছে) */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Noto Sans Bengali";
            background-color: #f4f4f9; margin: 0; padding: 0; display: flex; justify-content: center; min-height: 100vh;
        }
        .mobile-container {
            width: 100%; max-width: 450px; background-color: white; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); overflow: hidden; display: flex; flex-direction: column; min-height: 100vh;
        }
        /* সিমুলেটেড হেডার (মোবাইল টাইম/ব্যাটারি) রিমুভ করা হয়েছে */
        .main-content {
            flex-grow: 1; overflow-y: auto; padding: 0 15px 15px 15px; padding-top: 15px; /* কন্টেন্টের শুরুতে প্যাডিং যোগ করা হয়েছে */
        }
        .screen {
            display: none;
        }
        .screen.active {
            display: block;
        }
        .card {
            background-color: white; border-radius: 15px; margin-top: 15px; padding: 20px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        .balance-card {
            background: linear-gradient(135deg, #6e39b9, #9c5cff); color: white; padding: 25px; text-align: left; position: relative;
        }
        .balance-card h4 {
            margin: 0 0 5px 0; font-weight: 300; font-size: 14px;
        }
        .balance-card .amount {
            font-size: 36px; font-weight: bold; margin-bottom: 10px;
        }
        .balance-card button {
            background-color: white; color: #6e39b9; border: none; padding: 8px 15px; border-radius: 8px; font-weight: bold; cursor: pointer;
        }
        .balance-card .status {
            font-size: 12px; opacity: 0.8; margin-top: 10px;
        }
        .card-icon {
            position: absolute; top: 25px; right: 25px; font-size: 24px;
        }
        .refer-card {
            background-color: #f7f3ff; display: flex; justify-content: space-between; align-items: center;
        }
        .refer-card .hot-tag {
            background-color: #ff6347; color: white; padding: 2px 8px; border-radius: 5px; font-size: 12px; font-weight: bold; margin-left: 5px;
        }
        .refer-card button {
            background-color: #6e39b9; color: white;
        }
        .stat-grid {
            display: flex; justify-content: space-between; gap: 10px; margin-top: 15px;
        }
        .stat-item {
            flex: 1; padding: 15px; background-color: white; border-radius: 10px; text-align: center; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .withdraw-section input, .withdraw-section button {
            width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box;
        }
        .withdraw-section button.primary {
            background-color: #5cb85c; color: white; font-weight: bold; border: none;
        }
        .downline-stats {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px;
        }
        .downline-item {
            text-align: center; padding: 15px; background-color: #f0f0f5; border-radius: 10px;
        }
        .downline-item .count {
            font-size: 22px; font-weight: bold; color: #6e39b9;
        }
        .downline-item .label {
            font-size: 12px; color: #666;
        }
        .footer-nav {
            display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #eee; background-color: white; width: 100%; max-width: 450px; position: sticky; bottom: 0; box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.03);
        }
        .nav-item {
            text-align: center; color: #999; font-size: 12px; cursor: pointer; width: 25%;
        }
        .nav-item i {
            font-size: 20px; margin-bottom: 4px; color: #ccc;
        }
        .nav-item.active i, .nav-item.active span {
            color: #6e39b9;
        }
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 15px; max-width: 90%; width: 350px; text-align: center; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .bkash-number {
            font-size: 20px; font-weight: bold; color: #e2136e; margin: 10px 0 20px 0; border: 2px dashed #e2136e; padding: 10px; background-color: #ffeef2; border-radius: 8px;
        }
        .modal-content input, .modal-content button {
            padding: 10px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #ddd; width: 100%; box-sizing: border-box;
        }
        .modal-submit-btn {
            background-color: #6e39b9; color: white; font-weight: bold; border: none; cursor: pointer;
        }
    </style>
</head>
<body>

<div class="mobile-container">
    
    <!-- টপ স্ট্যাটাস বার সিমুলেশন রিমুভ করা হয়েছে -->
    
    <!-- মেইন কনটেন্ট এরিয়া -->
    <div class="main-content">
        
        <!-- ======================= 1. HOME SCREEN ======================= -->
        <div id="home-screen" class="screen active">
            <!-- Wallet Card -->
            <div class="card balance-card">
                <i class="fas fa-wallet card-icon"></i>
                <h4 id="user-welcome">Welcome back, User</h4>
                <span class="amount" id="home-balance">৳0.00</span>
                <div class="status">
                    <span id="activation-status-dot" style="color: #ffcc00; margin-right: 5px;">&#9679;</span>
                    <span id="activation-status-text">Inactive</span>
                    <span style="margin-left: 10px;">UID: <span id="user-uid">Loading...</span></span>
                </div>
                <button id="activate-btn" onclick="openActivationModal()">
                    <i class="fas fa-bolt"></i> Activate (৳300)
                </button>
            </div>

            <!-- Refer & Earn -->
            <div class="card refer-card">
                <div>
                    <h4 style="margin: 0; color: #333;">Your Referral Code</h4>
                    <p style="font-size: 16px; font-weight: bold; color: #6e39b9; margin: 5px 0 0 0;" id="ref-code">Loading...</p>
                </div>
                <button onclick="copyReferralLink()">Sharing</button>
            </div>
            
            <!-- Income/Referral Stats -->
            <div class="stat-grid">
                <div class="stat-item">
                    <i class="fas fa-trophy" style="color: #5cb85c;"></i>
                    <h5 style="margin: 5px 0;">Total Income</h5>
                    <p style="font-weight: bold; margin: 0;" id="total-income">৳0.00</p>
                </div>
                <div class="stat-item">
                    <i class="fas fa-chart-line" style="color: #6e39b9;"></i>
                    <h5 style="margin: 5px 0;">Pending</h5>
                    <p style="font-weight: bold; margin: 0;">৳0.00</p>
                </div>
            </div>

            <h4 style="margin-top: 20px; color: #333;">
                Recent Activity
            </h4>
            <ul style="list-style: none; padding: 0;" id="recent-activity">
                <li style="font-size: 14px; color: #888; padding: 10px 0;">No recent activity.</li>
            </ul>
        </div>
        
        <!-- ======================= 2. WALLET SCREEN ======================= -->
        <div id="wallet-screen" class="screen">
            <h3 style="color: #6e39b9;"><i class="fas fa-wallet"></i> Wallet & Withdrawal</h3>
            
            <!-- Balance Card (Wallet System) -->
            <div class="card balance-card">
                <i class="fas fa-dollar-sign card-icon"></i>
                <h4 style="font-size: 16px;">Current Balance</h4>
                <span class="amount" id="wallet-balance">৳0.00</span>
                <p style="font-size: 12px; margin: 0;">(Minimum Withdrawal: ৳500)</p>
            </div>

            <!-- Withdrawal System -->
            <div class="card withdraw-section">
                <h4 style="margin-top: 0; color: #333;">Withdrawal Request</h4>
                <input type="number" id="withdraw-amount" placeholder="Withdrawal Amount (Min 500)" required>
                <input type="text" id="withdraw-number" placeholder="Bkash/Nagad Number" required>
                <button class="primary" onclick="submitWithdrawalRequest()">Request Withdrawal</button>
                <p style="font-size: 12px; color: #888; text-align: center; margin: 0;">Processing fee may apply.</p>
            </div>
            
            <!-- Withdrawal History -->
            <div class="card">
                <h4 style="margin-top: 0; color: #333;">Withdrawal History</h4>
                <ul style="list-style: none; padding: 0; margin: 0;" id="withdrawal-history">
                    <li style="font-size: 14px; color: #888; padding: 10px 0;">No withdrawal history.</li>
                </ul>
            </div>
        </div>

        <!-- ======================= 3. PEOPLE SCREEN ======================= -->
        <div id="people-screen" class="screen">
            <h3 style="color: #6e39b9;"><i class="fas fa-user-friends"></i> Downline Network</h3>

            <div class="card profile-summary">
                <i class="fas fa-user-circle" style="font-size: 40px; color: #6e39b9;"></i>
                <h4>Network Stats</h4>
            </div>
            
            <div class="downline-stats">
                <div class="downline-item">
                    <div class="count" id="total-referrals">0</div>
                    <div class="label">Total Referrals</div>
                </div>
                <div class="downline-item">
                    <div class="count" id="total-downlines">0</div>
                    <div class="label">Total Downlines</div>
                </div>
                <div class="downline-item">
                    <div class="count" id="downline-balance">৳0.00</div>
                    <div class="label">Downline Balance</div>
                </div>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <h4 style="margin-top: 0; color: #333;">Downline List</h4>
                <ul style="list-style: none; padding: 0; margin: 0;" id="downline-list">
                    <li style="font-size: 14px; color: #888; padding: 10px 0;">No downlines yet.</li>
                </ul>
            </div>
        </div>

        <!-- ======================= 4. PLAN SCREEN (Income Logic) ======================= -->
        <div id="plan-screen" class="screen">
             <!-- Income Logic Card -->
            <div class="card income-logic" style="margin-top: 0;">
                <h3><i class="fas fa-chart-line"></i> Income Logic</h3>
                <div style="background-color: #f0f0f5; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <span>Activation Cost</span>
                    <span style="font-size: 28px; font-weight: bold; color: #6e39b9; float: right;">৳300</span>
                    <div style="clear: both;"></div>
                    <p style="font-size: 14px; color: #666; margin: 5px 0 0 0;">300 Taka is distributed to the uplines according to your custom chart below.</p>
                </div>
                <div class="level-list">
                    <div class="level-item"><div class="level-info"><span class="level-number">1</span><span>DIRECT REFERRAL</span></div><div style="display: flex; align-items: center;"><span class="level-amount">Receives ৳80</span><span class="you-tag" style="background-color: #5cb85c; color: white; padding: 2px 8px; border-radius: 5px; font-size: 12px; margin-left: 10px;">YOU</span></div></div>
                    <div class="level-item"><div class="level-info"><span class="level-number">2</span><span>1ST LEVEL UPLINE</span></div><span class="level-amount">Receives ৳35</span></div>
                    <div class="level-item"><div class="level-info"><span class="level-number">3</span><span>2ND LEVEL UPLINE</span></div><span class="level-amount">Receives ৳25</span></div>
                    <div class="level-item"><div class="level-info"><span class="level-number">4</span><span>3RD LEVEL UPLINE</span></div><span class="level-amount">Receives ৳15</span></div>
                    <div class="level-item"><div class="level-info"><span class="level-number">5</span><span>4TH LEVEL UPLINE</span></div><span class="level-amount">Receives ৳10</span></div>
                    <div class="level-item"><div class="level-info"><span class="level-number">6-15</span><span>NEXT 10 UPLINES (৳3 x 10)</span></div><span class="level-amount">Receives ৳3 Each</span></div>
                    <div class="level-item" style="border-bottom: none;"><div class="level-info"><span class="level-number">16-35</span><span>NEXT 20 UPLINES (৳2 x 20)</span></div><span class="level-amount">Receives ৳2 Each</span></div>
                    <p style="font-size: 12px; color: #888; text-align: right; margin-top: 10px;">Total Distributed: ৳235.00</p>
                </div>
            </div>
        </div>

    </div>

    <!-- ফুটার নেভিগেশন -->
    <div class="footer-nav">
        <div class="nav-item active" onclick="showScreen('home-screen', this)">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </div>
        <div class="nav-item" onclick="showScreen('wallet-screen', this)">
            <i class="fas fa-wallet"></i>
            <span>Wallet</span>
        </div>
        <div class="nav-item" onclick="showScreen('people-screen', this)">
            <i class="fas fa-user-friends"></i>
            <span>People</span>
        </div>
        <div class="nav-item" onclick="showScreen('plan-screen', this)">
            <i class="fas fa-chart-line"></i>
            <span>Plan</span>
        </div>
    </div>
</div>

<!-- অ্যাক্টিভেশন মোডাল সিমুলেশন -->
<div id="activation-modal" class="modal">
    <div class="modal-content">
        <h4 style="border-bottom: 2px solid #ddd; padding-bottom: 10px; color: #6e39b9;">Account Activation (৳300)</h4>
        <p>অনুগ্রহ করে নিচের বিকাশ/নগদ নাম্বারে ৳300 টাকা সেন্ড মানি করুন।</p>
        <p style="font-weight: bold; color: #555;">Payment Number:</p>
        <div class="bkash-number" id="modal-payment-number">Loading...</div>
        
        <label for="trx-number" style="display: block; text-align: left; font-size: 14px; margin-bottom: 5px;">Your Payment Number:</label>
        <input type="text" id="trx-number" placeholder="আপনার যে নাম্বার থেকে টাকা পাঠিয়েছেন" required>

        <label for="transaction-id" style="display: block; text-align: left; font-size: 14px; margin-bottom: 5px;">Transaction ID (TrxID) সাবমিট করুন:</label>
        <input type="text" id="transaction-id" placeholder="এখানে আপনার TrxID লিখুন" required>
        
        <button class="modal-submit-btn" onclick="submitActivationRequest()">
            Submit Activation Request
        </button>
        <button style="background: #eee; color: #333; border: none; padding: 10px; border-radius: 8px; width: 100%;" onclick="document.getElementById('activation-modal').style.display='none'">
            Cancel
        </button>
    </div>
</div>

<script>
    // আপনার দেওয়া Firebase কনফিগারেশন
    const firebaseConfig = {
      apiKey: "AIzaSyCKR2KyLhJoB_qdMBpoJN5raBWDCRDEonE",
      authDomain: "earning-7bc45.firebaseapp.com",
      databaseURL: "https://earning-7bc45-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "earning-7bc45",
      storageBucket: "earning-7bc45.firebasestorage.app",
      messagingSenderId: "94413359022",
      appId: "1:94413359022:web:db5b84117334175c7f2a3f"
    };

    // Firebase Initialize
    const app = firebase.initializeApp(firebaseConfig);
    const auth = app.auth();
    const db = app.database();
    let currentUserId = null;
    let currentUserData = null;
    const APP_ROOT_URL = window.location.href.split('?')[0];

    // ====================================================================
    // ১. Authentication এবং User Data Initialization
    // ====================================================================

    auth.onAuthStateChanged(user => {
        if (user) {
            currentUserId = user.uid;
            document.getElementById('user-uid').innerText = user.uid.substring(0, 8);
            
            // রিয়েলটাইম ডেটা লোড করা
            db.ref('users/' + currentUserId).on('value', snapshot => {
                const userData = snapshot.val() || {
                    email: user.email || 'Guest',
                    balance: 0, // নতুন ইউজারদের ব্যালেন্স 0 নিশ্চিত করা হয়েছে
                    isActivated: false,
                    totalReferrals: 0,
                    totalDownlines: 0,
                    referredBy: new URLSearchParams(window.location.search).get('ref') || null,
                    referralCode: user.uid.substring(0, 8).toUpperCase()
                };
                currentUserData = userData;
                updateUI(userData);
            });

            // সেটিংস থেকে পেমেন্ট নাম্বার লোড করা (ফিক্স করা হয়েছে)
            db.ref('settings/bkashPaymentNumber').on('value', snapshot => {
                const number = snapshot.val() || '01XXXXXXXXX (Admin Not Set)';
                document.getElementById('modal-payment-number').innerText = number;
            });
            
            // যদি ইউজার নতুন হয়, তবে ডেটাবেসে ইনিশিয়ালাইজ করা
            db.ref('users/' + currentUserId).once('value', snapshot => {
                if (!snapshot.exists()) {
                    db.ref('users/' + currentUserId).set(currentUserData);
                }
            });

        } else {
            // যদি কেউ লগইন না থাকে, তবে Anonymous Login করানো
            auth.signInAnonymously()
                .catch((error) => {
                    console.error("Anonymous sign-in failed: ", error);
                    // Fallback UI
                });
        }
    });

    // ====================================================================
    // ২. UI Update Function
    // ====================================================================

    function updateUI(data) {
        // ব্যালেন্স 0 বা রিয়েল ভ্যালু দেখানোর জন্য ফিক্সড করা হয়েছে
        const balance = data.balance || 0; 

        document.getElementById('user-welcome').innerText = `Welcome back, ${data.email.split('@')[0]}`;
        document.getElementById('home-balance').innerText = `৳${balance.toFixed(2)}`;
        document.getElementById('total-income').innerText = `৳${balance.toFixed(2)}`;
        document.getElementById('wallet-balance').innerText = `৳${balance.toFixed(2)}`;
        document.getElementById('ref-code').innerText = data.referralCode;

        // Activation Status
        const statusDot = document.getElementById('activation-status-dot');
        const statusText = document.getElementById('activation-status-text');
        const activateBtn = document.getElementById('activate-btn');
        
        if (data.isActivated) {
            statusDot.style.color = '#5cb85c'; // Green
            statusText.innerText = 'Active';
            activateBtn.style.display = 'none';
        } else {
            statusDot.style.color = '#ffcc00'; // Yellow
            statusText.innerText = 'Inactive';
            activateBtn.style.display = 'block';
        }

        // People Screen Stats
        document.getElementById('total-referrals').innerText = data.totalReferrals || 0;
        document.getElementById('total-downlines').innerText = data.totalDownlines || 0;
        document.getElementById('downline-balance').innerText = '৳0.00'; // Prototyping
    }

    // ====================================================================
    // ৩. Core Features (Activation, Withdrawal, Navigation) - (Same as before)
    // ====================================================================

    function showScreen(screenId, navItem) {
        document.querySelectorAll('.screen').forEach(screen => {
            screen.classList.remove('active');
        });
        document.getElementById(screenId).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
        });
        if (navItem) {
            navItem.classList.add('active');
        }
    }

    function openActivationModal() {
        if (currentUserData && currentUserData.isActivated) {
            alert("Your account is already active!");
            return;
        }
        document.getElementById('activation-modal').style.display='flex';
    }

    function submitActivationRequest() {
        // Validation and Firebase code
    }

    function submitWithdrawalRequest() {
        // Validation and Firebase code
    }
    
    function copyReferralLink() {
        // Logic
    }

    // ... (rest of the activation/withdrawal logic can be copied from the previous answer)
</script>

</body>
</html>
